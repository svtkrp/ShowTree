<!doctype html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Теория | Красно-черное дерево</title>
  </head>
  <body>
    <h1>Теория про красно-черные деревья:</h1>
    <p><b>Двоичное дерево поиска</b> (англ. <i>binary search tree, BST</i>) — это двоичное дерево, для которого выполняются следующие дополнительные <b>условия</b> (свойства):</p>
    <ol>
      <li>Оба поддерева — левое и правое — являются двоичными деревьями поиска.</li>
      <li>Значения всех узлов <b>левого</b> поддерева произвольного узла X <b>меньше</b> значения самого узла X.</li>
      <li>Значения всех узлов <b>правого</b> поддерева произвольного узла X <b>больше</b> значения самого узла X.</li>
    </ol>
    <img src="./images/BST.png" alt="BST example" style="max-width:100%;height:auto;max-height:200px;" />
    <h4>Поиск:</h4>
    <p>Обозначения: T - дерево, в котором мы ищем узел с ключом K. Алгоритм: если дерево пусто, сообщить, что узел не найден, и остановиться. Иначе сравнить K со значением ключа корневого узла X. Если K равен X, выдать ссылку на этот узел и остановиться. Если K больше X, рекурсивно искать ключ K в правом поддереве Т. Если K меньше X, рекурсивно искать ключ K в левом поддереве Т.</p>
    <h4>Вставка:</h4>
    <p>Обозначения: T - дерево, в которое нужно вставить узел N. Алгоритм: если дерево пусто, заменить его на дерево с одним корневым узлом N и остановиться. Иначе сравнить ключ N с ключом корневого узла X. Если ключ N больше X, рекурсивно добавить N в правое поддерево Т. Если ключ N меньше X, рекурсивно добавить N в левое поддерево Т. Если ключ N равен X, ничего не делать, такой узел уже есть.</p>
    <h4>Удаление:</h4>
    <p>Скоро будет, пока можно прочитать <a href="https://ru.wikipedia.org/wiki/%D0%94%D0%B2%D0%BE%D0%B8%D1%87%D0%BD%D0%BE%D0%B5_%D0%B4%D0%B5%D1%80%D0%B5%D0%B2%D0%BE_%D0%BF%D0%BE%D0%B8%D1%81%D0%BA%D0%B0#%D0%A3%D0%B4%D0%B0%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5_%D1%83%D0%B7%D0%BB%D0%B0_(REMOVE)">здесь</a>.</p>
    <hr class="solid">
    <p><b>Красно-чёрное дерево</b> (англ. <i>Red-black tree, RB-Tree</i>) — один из видов самобалансирующихся двоичных деревьев поиска, гарантирующих логарифмический рост высоты дерева от числа узлов и позволяющее быстро выполнять основные операции дерева поиска: добавление, удаление и поиск узла. Сбалансированность достигается за счёт введения дополнительного атрибута узла дерева — «<b>цвета</b>». Этот атрибут может принимать одно из двух возможных значений — «<b>чёрный</b>» или «<b>красный</b>». <b>Свойства</b> красно-черного дерева: </p>
    <ol>
      <li>Узел может быть либо красным, либо чёрным и имеет двух потомков;</li>
      <li>Корень — чёрный;</li>
      <li>Все листья — чёрные и не содержат данных.</li>
      <li>Оба потомка каждого красного узла — чёрные.</li>
      <li>Путь от узла-предка до каждого его листового узла-потомка содержит одинаковое число чёрных узлов.</li>
    </ol>
    <img src="./images/RB_tree.png" alt="RB-tree example" style="max-width:100%;height:auto;max-height:200px;" />
    <h4>Поиск:</h4>
    <p>Алгоритм в точности такой же, как и для любого двоичного дерева поиска.</p>
    <h4>Вставка:</h4>
    <p>Новый узел в красно-чёрное дерево добавляется на место одного из листьев по алгоритму двоичного дерева поиска, окрашивается в красный цвет и к нему прикрепляется два листа. Что происходит дальше, зависит от цвета близлежащих узлов.</p>
    <p><i>Далее N - текущий узел (от node), P - родитель N (от parent), G - дед N (родитель P; от grandparent), U - дядя N (брат P и другой сын G; от uncle).</i></p>
    <p><b>Случай 1</b>: Текущий узел N в корне дерева. В этом случае он перекрашивается в чёрный цвет, чтобы оставить верным Свойство 2 (Корень — чёрный). Так как это действие добавляет один чёрный узел в каждый путь, Свойство 5 (Все пути от любого данного узла до листовых узлов содержат одинаковое число чёрных узлов) не нарушается.</p>
    <p><b>Случай 2</b>: Предок P текущего узла чёрный, то есть Свойство 4 (Оба потомка каждого красного узла — чёрные) не нарушается. В этом случае дерево остаётся корректным. Свойство 5 (Все пути от любого данного узла до листовых узлов содержат одинаковое число чёрных узлов) не нарушается, потому что текущий узел N имеет двух чёрных листовых потомков, но так как N является красным, путь до каждого из этих потомков содержит такое же число чёрных узлов, что и путь до чёрного листа, который был заменен текущим узлом, так что свойство остается верным.</p>
    <p><i>В следующих случаях предполагается, что у N есть дедушка G, так как его родитель P является красным, а если бы он был корнем, то был бы окрашен в чёрный цвет. Таким образом, N также имеет дядю U, хотя он может быть листовым узлом в случаях 4 и 5.</i></p>
    <p><b>Случай 3</b>: Если и родитель P, и дядя U — красные, то они оба могут быть перекрашены в чёрный, и дедушка G станет красным (для сохранения свойства 5 (Все пути от любого данного узла до листовых узлов содержат одинаковое число чёрных узлов)). Теперь у текущего красного узла N чёрный родитель. Так как любой путь через родителя или дядю должен проходить через дедушку, число чёрных узлов в этих путях не изменится. Однако, дедушка G теперь может нарушить свойства 2 (Корень — чёрный) или 4 (Оба потомка каждого красного узла — чёрные) (свойство 4 может быть нарушено, так как родитель G может быть красным). Чтобы это исправить, вся процедура рекурсивно выполняется на G из случая 1.</p>
    <img src="./images/RB_tree_insert_case_3.png" alt="RB-tree example" style="max-width:100%;height:auto;max-height:200px;" />
    <p><i>В оставшихся случаях предполагается, что родитель P является левым потомком своего предка. Если это не так, необходимо поменять лево и право.</i></p>
    <p><b>Случай 4</b>: Родитель P является красным, но дядя U — чёрный. Также, текущий узел N — правый потомок P, а P в свою очередь — левый потомок своего предка G. В этом случае может быть произведен поворот дерева, который меняет роли текущего узла N и его предка P. Тогда, для бывшего родительского узла P в обновленной структуре используем случай 5, потому что Свойство 4 (Оба потомка любого красного узла — чёрные) все ещё нарушено. Вращение приводит к тому, что некоторые пути (в поддереве, обозначенном «1» на схеме) проходят через узел N, чего не было до этого. Это также приводит к тому, что некоторые пути (в поддереве, обозначенном «3») не проходят через узел P. Однако, оба эти узла являются красными, так что Свойство 5 (Все пути от любого данного узла до листовых узлов содержат одинаковое число чёрных узлов) не нарушается при вращении. Однако Свойство 4 всё ещё нарушается, но теперь задача сводится к Случаю 5.</p>
    <img src="./images/RB_tree_insert_case_4.png" alt="RB-tree example" style="max-width:100%;height:auto;max-height:200px;" />
    <p><b>Случай 5</b>: Родитель P является красным, но дядя U — чёрный, текущий узел N — левый потомок P и P — левый потомок G. В этом случае выполняется поворот дерева на G. В результате получается дерево, в котором бывший родитель P теперь является родителем и текущего узла N и бывшего дедушки G. Известно, что G — чёрный, так как его бывший потомок P не мог бы в противном случае быть красным (без нарушения Свойства 4). Тогда цвета P и G меняются и в результате дерево удовлетворяет Свойству 4 (Оба потомка любого красного узла — чёрные). Свойство 5 (Все пути от любого данного узла до листовых узлов содержат одинаковое число чёрных узлов) также остается верным, так как все пути, которые проходят через любой из этих трех узлов, ранее проходили через G, поэтому теперь они все проходят через P. В каждом случае, из этих трёх узлов только один окрашен в чёрный.</p>
    <img src="./images/RB_tree_insert_case_5.png" alt="RB-tree example" style="max-width:100%;height:auto;max-height:200px;" />
    <h4>Удаление:</h4>
    <p>Скоро будет, пока можно прочитать <a href="https://ru.wikipedia.org/wiki/%D0%9A%D1%80%D0%B0%D1%81%D0%BD%D0%BE-%D1%87%D1%91%D1%80%D0%BD%D0%BE%D0%B5_%D0%B4%D0%B5%D1%80%D0%B5%D0%B2%D0%BE#%D0%A3%D0%B4%D0%B0%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5">здесь</a>.</p>
    <p><a href="RBTree.html">Визуализация алгоритмов вставки, поиска и удаления узла для красно-черных деревьев...</a></p>
  </body>
</html>
